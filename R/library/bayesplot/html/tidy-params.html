<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Tidy parameter selection</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for tidy-params {bayesplot}"><tr><td>tidy-params {bayesplot}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Tidy parameter selection</h2>

<h3>Description</h3>

<p>Parameter selection in the style of <strong>dplyr</strong> and other tidyverse packages.
</p>


<h3>Usage</h3>

<pre>
param_range(prefix, range, vars = NULL)

param_glue(pattern, ..., vars = NULL)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>prefix, range</code></td>
<td>
<p>For <code>param_range()</code> only, <code>prefix</code> is a string naming a
parameter and <code>range</code> is an integer vector providing the indices of a
subset of elements to select. For example, using</p>
<pre>  param_range("beta", c(1,2,8))
</pre>
<p>would select parameters named <code>beta[1]</code>, <code>beta[2]</code>, and <code>beta[8]</code>.
<code>param_range()</code> is only designed for the case that the indices are integers
surrounded by brackets. If there are no brackets use
<a href="../../tidyselect/html/select_helpers.html">num_range()</a>.</p>
</td></tr>
<tr valign="top"><td><code>vars</code></td>
<td>
<p><code>NULL</code> or a character vector of parameter names to choose from.
This is only needed for the atypical use case of calling the function as a
standalone function outside of <code>vars()</code>, <code>select()</code>, etc. Typically this is
left as <code>NULL</code> and will be set automatically for the user.</p>
</td></tr>
<tr valign="top"><td><code>pattern, ...</code></td>
<td>
<p>For <code>param_glue()</code> only, <code>pattern</code> is a string containing
expressions enclosed in braces and <code>...</code> should be named arguments
providing one character vector per expression in braces in <code>pattern</code>. It is
easiest to describe how to use these arguments with an example:</p>
<pre>param_glue("beta_{var}[{level}]",
           var = c("age", "income"),
           level = c(3,8))
</pre>
<p>would select parameters with names
<code>"beta_age[3]"</code>, <code>"beta_income[3]"</code>, <code>"beta_age[8]"</code>, <code>"beta_income[8]"</code>.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>As of version <code style="white-space: pre;">1.7.0</code>, <strong>bayesplot</strong> allows the <code>pars</code> argument for <a href="MCMC-overview.html">MCMC plots</a> to use &quot;tidy&quot; variable selection (in the
style of the <strong>dplyr</strong> package). The <code><a href="../../dplyr/html/vars.html">vars()</a></code> function is
re-exported from <strong>dplyr</strong> for this purpose.
</p>
<p>Features of tidy selection includes direct selection (<code>vars(alpha, sigma)</code>),
everything-but selection (<code>vars(-alpha)</code>), ranged selection
(<code>vars(`beta[1]`:`beta[3]`)</code>), support for selection functions
(<code>vars(starts_with("beta"))</code>), and combinations of these features. See the
<strong>Examples</strong> section, below.
</p>
<p>When using <code>pars</code> for tidy parameter selection, the <code>regex_pars</code> argument is
ignored because <strong>bayesplot</strong> supports using <a href="../../tidyselect/html/select_helpers.html">tidyselect helper functions</a> (<code>starts_with()</code>, <code>contains()</code>,
<code>num_range()</code>, etc.) for the same purpose. <strong>bayesplot</strong> also exports some
additional helper functions to help with parameter selection:
</p>

<ul>
<li> <p><code>param_range()</code>: like <code><a href="../../tidyselect/html/num_range.html">num_range()</a></code> but used
when parameter indexes are in brackets (e.g. <code>beta[2]</code>).
</p>
</li>
<li> <p><code>param_glue()</code>: for more complicated parameter names with multiple
indexes (including variable names) inside the brackets
(e.g., <code style="white-space: pre;">beta[(Intercept) age_group:3]</code>).
</p>
</li></ul>

<p>These functions can be used inside of <code>vars()</code>, <code>dplyr::select()</code>,
and similar functions, just like the
<a href="../../tidyselect/html/select_helpers.html">tidyselect helper functions</a>.
</p>


<h3>Extra Advice</h3>

<p>Parameter names in <code>vars()</code> are not quoted. When the names contain special
characters like brackets, they should be wrapped in backticks, as in
<code>vars(`beta[1]`)</code>.
</p>
<p>To exclude a range of variables, wrap the sequence in parentheses and then
negate it. For example, (<code>vars(-(`beta[1]`:`beta[3]`))</code>) would exclude
<code>beta[1]</code>, <code>beta[2]</code>, and <code>beta[3]</code>.
</p>
<p><code>vars()</code> is a helper function. It holds onto the names and expressions used
to select columns. When selecting variables inside a <strong>bayesplot</strong>
function, use <code>vars(...)</code>: <code>mcmc_hist(data, pars = vars(alpha))</code>. When
using <code>select()</code> to prepare a dataframe for a <strong>bayesplot</strong> function, do
not use <code>vars()</code>: <code>data %&gt;% select(alpha) %&gt;% mcmc_hist()</code>.
</p>
<p>Internally, tidy selection works by converting names and expressions
into position numbers. As a result, integers will select parameters;
<code>vars(1, 3)</code> selects the first and third ones. We do not endorse this
approach because positions might change as variables are added and
removed from models. To select a parameter that happens to be called <code>1</code>,
use backticks to escape it <code>vars(`1`)</code>.
</p>


<h3>See Also</h3>

<p><code><a href="../../glue/html/glue.html">glue::glue()</a></code>
</p>


<h3>Examples</h3>

<pre>
x &lt;- example_mcmc_draws(params = 6)
dimnames(x)
mcmc_hex(x, pars = vars(alpha, `beta[2]`))
mcmc_dens(x, pars = vars(sigma, contains("beta")))
mcmc_hist(x, pars = vars(-contains("beta")))

# using the param_range() helper
mcmc_hist(x, pars = vars(param_range("beta", c(1, 3, 4))))


#############################
## Examples using rstanarm ##
#############################
if (requireNamespace("rstanarm", quietly = TRUE)) {
  # see ?rstanarm::example_model
  fit &lt;- example("example_model", package = "rstanarm", local=TRUE)$value
  print(fit)
  posterior &lt;- as.data.frame(fit)
  str(posterior)

  color_scheme_set("brightblue")
  mcmc_hist(posterior, pars = vars(size, contains("period")))

  # same as previous but using dplyr::select() and piping
  library("dplyr")
  posterior %&gt;%
    select(size, contains("period")) %&gt;%
    mcmc_hist()

  mcmc_intervals(posterior, pars = vars(contains("herd")))
  mcmc_intervals(posterior, pars = vars(contains("herd"), -contains("Sigma")))

  bayesplot_theme_set(ggplot2::theme_dark())
  color_scheme_set("viridisC")
  mcmc_areas_ridges(posterior, pars = vars(starts_with("b[")))

  bayesplot_theme_set()
  color_scheme_set("purple")
  not_789 &lt;- vars(starts_with("b["), -matches("[7-9]"))
  mcmc_intervals(posterior, pars = not_789)

  # using the param_glue() helper
  just_149 &lt;- vars(param_glue("b[(Intercept) herd:{level}]", level = c(1,4,9)))
  mcmc_intervals(posterior, pars = just_149)

  # same but using param_glue() with dplyr::select()
  # before passing to bayesplot
  posterior %&gt;%
    select(param_glue("b[(Intercept) herd:{level}]",
                      level = c(1, 4, 9))) %&gt;%
    mcmc_intervals()
}

## Not run: 
###################################
## More examples of param_glue() ##
###################################
library(dplyr)
posterior &lt;- tibble(
  b_Intercept = rnorm(1000),
  sd_condition__Intercept = rexp(1000),
  sigma = rexp(1000),
  `r_condition[A,Intercept]` = rnorm(1000),
  `r_condition[B,Intercept]` = rnorm(1000),
  `r_condition[C,Intercept]` = rnorm(1000),
  `r_condition[A,Slope]` = rnorm(1000),
  `r_condition[B,Slope]` = rnorm(1000)
)
posterior

# using one expression in braces
posterior %&gt;%
  select(
    param_glue("r_condition[{level},Intercept]", level = c("A", "B"))
  ) %&gt;%
  mcmc_hist()

# using multiple expressions in braces
posterior %&gt;%
   select(
     param_glue(
       "r_condition[{level},{type}]",
        level = c("A", "B"),
        type = c("Intercept", "Slope"))
   ) %&gt;%
   mcmc_hist()

## End(Not run)
</pre>

<hr /><div style="text-align: center;">[Package <em>bayesplot</em> version 1.7.2 <a href="00Index.html">Index</a>]</div>
</body></html>
