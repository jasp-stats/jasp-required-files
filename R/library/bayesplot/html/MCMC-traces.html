<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Trace plots of MCMC draws</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for MCMC-traces {bayesplot}"><tr><td>MCMC-traces {bayesplot}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Trace plots of MCMC draws</h2>

<h3>Description</h3>

<p>Trace plot (or traceplot) of MCMC draws. See the <strong>Plot Descriptions</strong>
section, below, for details.
</p>


<h3>Usage</h3>

<pre>
mcmc_trace(
  x,
  pars = character(),
  regex_pars = character(),
  transformations = list(),
  ...,
  facet_args = list(),
  n_warmup = 0,
  iter1 = 0,
  window = NULL,
  size = NULL,
  np = NULL,
  np_style = trace_style_np(),
  divergences = NULL
)

mcmc_trace_highlight(
  x,
  pars = character(),
  regex_pars = character(),
  transformations = list(),
  ...,
  facet_args = list(),
  n_warmup = 0,
  window = NULL,
  size = NULL,
  alpha = 0.2,
  highlight = 1
)

trace_style_np(div_color = "red", div_size = 0.25, div_alpha = 1)

mcmc_rank_overlay(
  x,
  pars = character(),
  regex_pars = character(),
  transformations = list(),
  ...,
  n_bins = 20,
  ref_line = FALSE
)

mcmc_rank_hist(
  x,
  pars = character(),
  regex_pars = character(),
  transformations = list(),
  ...,
  facet_args = list(),
  n_bins = 20,
  ref_line = FALSE
)

mcmc_trace_data(
  x,
  pars = character(),
  regex_pars = character(),
  transformations = list(),
  ...,
  highlight = NULL,
  n_warmup = 0,
  iter1 = 0
)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>x</code></td>
<td>
<p>A 3-D array, matrix, list of matrices, or data frame of MCMC draws.
The <a href="MCMC-overview.html">MCMC-overview</a> page provides details on how to specify each these
allowed inputs. It is also possible to use an object with an
<code>as.array()</code> method that returns the same kind of 3-D array described on
the <a href="MCMC-overview.html">MCMC-overview</a> page.</p>
</td></tr>
<tr valign="top"><td><code>pars</code></td>
<td>
<p>An optional character vector of parameter names. If neither
<code>pars</code> nor <code>regex_pars</code> is specified then the default is to use <em>all</em>
parameters. As of version <code style="white-space: pre;">1.7.0</code>, <strong>bayesplot</strong> also supports 'tidy'
parameter selection by specifying <code>pars = vars(...)</code>, where <code>...</code> is
specified the same way as in <a href="../../dplyr/html/select.html">dplyr::select(...)</a> and
similar functions. Examples of using <code>pars</code> in this way can be found on the
<a href="tidy-params.html">Tidy parameter selection</a> page.</p>
</td></tr>
<tr valign="top"><td><code>regex_pars</code></td>
<td>
<p>An optional <a href="../../base/html/grep.html">regular expression</a> to use for
parameter selection. Can be specified instead of <code>pars</code> or in addition to
<code>pars</code>. When using <code>pars</code> for tidy parameter selection, the <code>regex_pars</code>
argument is ignored since <a href="../../tidyselect/html/select_helpers.html">select helpers</a>
perform a similar function.</p>
</td></tr>
<tr valign="top"><td><code>transformations</code></td>
<td>
<p>Optionally, transformations to apply to parameters
before plotting. If <code>transformations</code> is a function or a single string
naming a function then that function will be used to transform all
parameters. To apply transformations to particular parameters, the
<code>transformations</code> argument can be a named list with length equal to
the number of parameters to be transformed. Currently only univariate
transformations of scalar parameters can be specified (multivariate
transformations will be implemented in a future release). If
<code>transformations</code> is a list, the name of each list element should be a
parameter name and the content of each list element should be a function
(or any item to match as a function via <code><a href="../../base/html/match.fun.html">match.fun()</a></code>, e.g. a
string naming a function). If a function is specified by its name as a
string (e.g. <code>"log"</code>), then it can be used to construct a new
parameter label for the appropriate parameter (e.g. <code>"log(sigma)"</code>).
If a function itself is specified
(e.g. <code>log</code> or <code>function(x) log(x)</code>)
then <code>"t"</code> is used in the new parameter label to indicate that the
parameter is transformed (e.g. <code>"t(sigma)"</code>).
</p>
<p>Note: due to partial argument matching <code>transformations</code> can be
abbreviated for convenience in interactive use (e.g., <code>transform</code>).</p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>Currently ignored.</p>
</td></tr>
<tr valign="top"><td><code>facet_args</code></td>
<td>
<p>A named list of arguments (other than <code>facets</code>) passed
to <code><a href="../../ggplot2/html/facet_wrap.html">ggplot2::facet_wrap()</a></code> or <code><a href="../../ggplot2/html/facet_grid.html">ggplot2::facet_grid()</a></code>
to control faceting.</p>
</td></tr>
<tr valign="top"><td><code>n_warmup</code></td>
<td>
<p>An integer; the number of warmup iterations included in
<code>x</code>. The default is <code>n_warmup = 0</code>, i.e. to assume no warmup
iterations are included. If <code>n_warmup &gt; 0</code> then the background for
iterations <code>1:n_warmup</code> is shaded gray.</p>
</td></tr>
<tr valign="top"><td><code>iter1</code></td>
<td>
<p>An integer; the iteration number of the first included draw
(default is <code>0</code>). This can be used to make it more obvious that the warmup
iterations have been discarded from the traceplot. It cannot be specified
if <code>n_warmup</code> is also set to a positive value.</p>
</td></tr>
<tr valign="top"><td><code>window</code></td>
<td>
<p>An integer vector of length two specifying the limits of a
range of iterations to display.</p>
</td></tr>
<tr valign="top"><td><code>size</code></td>
<td>
<p>An optional value to override the default line size
for <code>mcmc_trace()</code> or the default point size for <code>mcmc_trace_highlight()</code>.</p>
</td></tr>
<tr valign="top"><td><code>np</code></td>
<td>
<p>For models fit using <a href="MCMC-nuts.html">NUTS</a> (more generally, any
<a href="https://en.wikipedia.org/wiki/Symplectic_integrator">symplectic integrator</a>),
an optional data frame providing NUTS diagnostic information. The data
frame should be the object returned by <code><a href="bayesplot-extractors.html">nuts_params()</a></code> or one with the same
structure. If <code>np</code> is specified then tick marks are added to the bottom of
the trace plot indicating within which iterations there was a divergence
(if there were any). See the end of the <strong>Examples</strong> section, below.</p>
</td></tr>
<tr valign="top"><td><code>np_style</code></td>
<td>
<p>A call to the <code>trace_style_np()</code> helper function to
specify arguments controlling the appearance of tick marks representing
divergences (if the <code>np</code> argument is specified).</p>
</td></tr>
<tr valign="top"><td><code>divergences</code></td>
<td>
<p>Deprecated. Use the <code>np</code> argument instead.</p>
</td></tr>
<tr valign="top"><td><code>alpha</code></td>
<td>
<p>For <code>mcmc_trace_highlight()</code>, passed to
<code><a href="../../ggplot2/html/geom_point.html">ggplot2::geom_point()</a></code> to control the transparency of the points
for the chains not highlighted.</p>
</td></tr>
<tr valign="top"><td><code>highlight</code></td>
<td>
<p>For <code>mcmc_trace_highlight()</code>, an integer specifying one
of the chains that will be more visible than the others in the plot.</p>
</td></tr>
<tr valign="top"><td><code>div_color, div_size, div_alpha</code></td>
<td>
<p>Optional arguments to the
<code>trace_style_np()</code> helper function that are eventually passed to
<code><a href="../../ggplot2/html/geom_rug.html">ggplot2::geom_rug()</a></code> if the <code>np</code> argument is also specified. They control
the color, size, and transparency specifications for showing divergences in
the plot. The default values are displayed in the <strong>Usage</strong> section above.</p>
</td></tr>
<tr valign="top"><td><code>n_bins</code></td>
<td>
<p>For the rank plots, the number of bins to use for the histogram
of rank-normalized MCMC samples. Defaults to <code>20</code>.</p>
</td></tr>
<tr valign="top"><td><code>ref_line</code></td>
<td>
<p>For the rank plots, whether to draw a horizontal line at the
average number of ranks per bin. Defaults to <code>FALSE</code>.</p>
</td></tr>
</table>


<h3>Value</h3>

<p>The plotting functions return a ggplot object that can be further
customized using the <strong>ggplot2</strong> package. The functions with suffix
<code style="white-space: pre;">_data()</code> return the data that would have been drawn by the plotting
function.
</p>
<p><code>mcmc_trace_data()</code> returns the data for the trace <em>and</em> rank plots
in the same data frame.
</p>


<h3>Plot Descriptions</h3>


<dl>
<dt><code>mcmc_trace()</code></dt><dd>
<p>Standard trace plots of MCMC draws. For models fit using <a href="MCMC-nuts.html">NUTS</a>,
the <code>np</code> argument can be used to also show divergences on the trace plot.
</p>
</dd>
<dt><code>mcmc_trace_highlight()</code></dt><dd>
<p>Traces are plotted using points rather than lines and the opacity of all
chains but one (specified by the <code>highlight</code> argument) is reduced.
</p>
</dd>
<dt><code>mcmc_rank_hist()</code></dt><dd>
<p>Whereas traditional trace plots visualize how the chains mix over the
course of sampling, rank histograms visualize how the values
from the chains mix together in terms of ranking. An ideal plot would
show the rankings mixing or overlapping in a uniform distribution.
See Vehtari et al. (2019) for details.
</p>
</dd>
<dt><code>mcmc_rank_overlay()</code></dt><dd>
<p>Ranks from <code>mcmc_rank_hist()</code> are plotted using overlaid lines in a
single panel.
</p>
</dd>
</dl>



<h3>References</h3>

<p>Vehtari, A., Gelman, A., Simpson, D., Carpenter, B., BÃ¼rkner, P.
(2019). Rank-normalization, folding, and localization: An improved <em>R</em>-hat
for assessing convergence of MCMC. <a href="https://arxiv.org/abs/1903.08008">arXiv preprint</a>.
</p>


<h3>See Also</h3>

<p>Other MCMC: 
<code><a href="MCMC-combos.html">MCMC-combos</a></code>,
<code><a href="MCMC-diagnostics.html">MCMC-diagnostics</a></code>,
<code><a href="MCMC-distributions.html">MCMC-distributions</a></code>,
<code><a href="MCMC-intervals.html">MCMC-intervals</a></code>,
<code><a href="MCMC-nuts.html">MCMC-nuts</a></code>,
<code><a href="MCMC-overview.html">MCMC-overview</a></code>,
<code><a href="MCMC-parcoord.html">MCMC-parcoord</a></code>,
<code><a href="MCMC-recover.html">MCMC-recover</a></code>,
<code><a href="MCMC-scatterplots.html">MCMC-scatterplots</a></code>
</p>


<h3>Examples</h3>

<pre>
# some parameter draws to use for demonstration
x &lt;- example_mcmc_draws(chains = 4, params = 6)
dim(x)
dimnames(x)

# trace plots of the betas
color_scheme_set("viridis")
mcmc_trace(x, regex_pars = "beta")

color_scheme_set("viridisA")
mcmc_trace(x, regex_pars = "beta")

color_scheme_set("viridisC")
mcmc_trace(x, regex_pars = "beta")


# mix color schemes
color_scheme_set("mix-blue-red")
mcmc_trace(x, regex_pars = "beta")

# use traditional ggplot discrete color scale
mcmc_trace(x, pars = c("alpha", "sigma")) +
 ggplot2::scale_color_discrete()

# zoom in on a window of iterations, increase line size,
# add tick marks, move legend to the top, add gray background
color_scheme_set("viridisA")
mcmc_trace(x[,, 1:4], window = c(100, 130), size = 1) +
  panel_bg(fill = "gray90", color = NA) +
  legend_move("top")

# Rank-normalized histogram plots. Instead of showing how chains mix over
# time, look at how the ranking of MCMC samples mixed between chains.
color_scheme_set("viridisE")
mcmc_rank_hist(x, "alpha")
mcmc_rank_hist(x, pars = c("alpha", "sigma"), ref_line = TRUE)
mcmc_rank_overlay(x, "alpha")

## Not run: 
# parse facet label text
color_scheme_set("purple")
p &lt;- mcmc_trace(
  x,
  regex_pars = "beta\\\[[1,3]\\\]",
  facet_args = list(labeller = ggplot2::label_parsed)
)
p + facet_text(size = 15)

# mark first 100 draws as warmup
mcmc_trace(x, n_warmup = 100)

# plot as points, highlighting chain 2
color_scheme_set("brightblue")
mcmc_trace_highlight(x, pars = "sigma", highlight = 2, size = 2)

# for models fit using HMC/NUTS divergences can be displayed in the trace plot
library("rstanarm")
fit &lt;- stan_glm(mpg ~ ., data = mtcars, refresh = 0,
  # next line to keep example fast and also ensure we get some divergences
                prior = hs(), iter = 400, adapt_delta = 0.8)

# extract draws using as.array (instead of as.matrix) to keep
# chains separate for trace plot
posterior &lt;- as.array(fit)

# for stanfit and stanreg objects use nuts_params() to get the divergences
mcmc_trace(posterior, pars = "sigma", np = nuts_params(fit))

color_scheme_set("viridis")
mcmc_trace(
  posterior,
  pars = c("wt", "sigma"),
  size = 0.5,
  facet_args = list(nrow = 2),
  np = nuts_params(fit),
  np_style = trace_style_np(div_color = "black", div_size = 0.5)
)

## End(Not run)

</pre>

<hr /><div style="text-align: center;">[Package <em>bayesplot</em> version 1.7.2 <a href="00Index.html">Index</a>]</div>
</body></html>
